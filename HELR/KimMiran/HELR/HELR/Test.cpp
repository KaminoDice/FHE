#include <cmath>
#include <iostream>
#include <stdio.h>
#include <vector>
#include <sys/time.h>
#include <chrono>
#include <sys/resource.h>   // check the memory usage
#include <stdio.h>
#include <thread>
#include <fstream>
#include <sstream>

#include <NTL/RR.h>
#include <NTL/xdouble.h>
#include <NTL/ZZ.h>
#include <NTL/ZZX.h>
#include <NTL/BasicThreadPool.h>


#include "../src/CZZ.h"
#include "../src/Params.h"
#include "../src/PubKey.h"
#include "../src/Scheme.h"
#include "../src/SchemeAlgo.h"
#include "../src/SecKey.h"
#include "../src/TestScheme.h"
#include "../src/TimeUtils.h"
#include "../src/Ring2Utils.h"
#include "../src/StringUtils.h"
#include "../src/EvaluatorUtils.h"

#include "Database.h"
#include "LRtest.h"
#include "HELR.h"


using namespace NTL;
using namespace std;

#define edin 0
#define lbw  0
#define nhanes 0
#define pcs 0
#define uis 1

#define deg3 0
#define deg7 1


int main(int Argc, char** Argv) {
    

    
    
    //-------------------------------------------------
    // edin 3
    
#if edin
    
    long dim = 10;
    
    dVec HEtheta;
    for(long i = 0; i < dim; ++i){
        HEtheta.push_back(0);
    }
    dVec theta = HEtheta;

    
#if deg3
    // enc
    double d1[5][10] = {
        {-2.3096, 0.0272073, 0.237126, 0.413105, 1.56539, 0.420032, 1.22366, 0.24056,  0.348441, -0.115547},
        {-2.30421, 0.100643, 0.258077, 0.425902, 1.57127, 0.487219, 1.2142,  0.299149, 0.344583, -0.232117},
        {-2.26649, 0.129234, 0.220046, 0.419709, 1.55028, 0.470247,  1.2181, 0.332275, 0.232887, -0.16465},
        {-2.27702,0.121896,0.210386,0.476516,1.55823,0.47324,1.29062,0.301172,0.322334,-0.222855},
        {-2.32468,0.13117,0.296224,0.455724,1.58208,0.488631,1.12723,0.293705,0.26573,-0.175652}
    };
    
    // unenc
    double d2[5][10]=  {
        {-1.84561,0.0410266,0.21145,0.375287,1.42349,0.393118,1.10869,0.260133,0.340038, -0.0301592},
        {-1.84228,0.107926,0.227087,0.387291,1.42572,0.464584,1.09585,0.309594,0.340326,-0.131425},
        {-1.80964,0.130404,0.196373,0.380948,1.41048,0.446163,1.10605,0.33555,0.240369,-0.07113},
        {-1.82295,0.1303,0.185208,0.432315,1.41445,0.445306,1.16731,0.309165,0.318403,-0.120376},
        {-1.85623,0.131818,0.270671,0.414115,1.43815,0.463057,1.02489,0.312728,0.27056,-0.0772305}
    };
#endif
    
#if deg7
    // enc
    double d1[5][10] = {
        {-1.70862,0.0767734,0.111934,0.320924,1.20332,0.368435,0.975623,0.202047,0.225981,-0.164111},
        {-1.72696,0.0828964,0.233901,0.325366,1.23315,0.352987,0.978842,0.285361,0.254023,-0.118856},
        {-1.77931,0.146215,0.19663,0.334124,1.22997,0.34505,0.88086,0.301459,0.227977,-0.096778},
        {-1.71429,0.0859897,0.223657,0.383277,1.26796,0.39982,0.966313,0.193434,0.266558,-0.106615},
        {-1.73692,0.039327,0.198135,0.353211,1.20737,0.384475,0.974432,0.22363,0.271022,-0.113051}
    };
    
    // unenc
    double d2[5][10]=  {
        {-1.63077,0.0775747,0.109707,0.315522,1.18099,0.365107,0.959937,0.208349,0.229848,-0.14904},
        {-1.64957,0.0842011,0.228315,0.318633,1.20718,0.348627,0.959917,0.289039,0.254139,-0.103792},
        {-1.70052,0.145764,0.1935,0.327747,1.20809,0.342304,0.867952,0.305434,0.232147,-0.0827491},
        {-1.63677,0.0875185,0.218174,0.375201,1.2413,0.395056,0.950016,0.197295,0.266842,-0.0921361},
        {-1.66,0.0414038,0.19404,0.346126,1.18316,0.380969,0.956811,0.228401,0.271773,-0.0986661}
    };
#endif
#endif
 
    //-----------------------------------------------------------------------------------------------
#if lbw
    
    long dim = 10;
    
    dVec HEtheta;
    for(long i = 0; i < dim; ++i){
        HEtheta.push_back(0);
    }
    dVec theta = HEtheta;
    
    
#if deg3
    // enc
    double d1[5][10] = {
        {0.422997,0.563842,0.574296,0.356639,-0.0901424,-0.3138,-0.249092,-0.262686,-0.273382,0.00652375},
        {0.326865,0.436024,0.504505,0.607584,-0.0901471,-0.226328,-0.263989,-0.234317,-0.231822,0.226328},
        {0.290507,0.422196,0.468165,0.671223,-0.26527,-0.374119,-0.269304,-0.247008,-0.00263957,0.103969},
        {0.356252,0.495548,0.534322,0.459868,-0.0386566,-0.162655,-0.22191,-0.110973,-0.361777,0.0766106},
        {0.366316,0.409031,0.513619,0.481204,-0.2051,-0.359439,-0.134855,-0.247572,-0.217659,0.155762}
    };
    
    // unenc
    double d2[5][10]=  {
        {0.268483,0.409213,0.416833,0.272224,-0.104962,-0.325568,-0.156486,-0.270302,-0.274935,-0.021582},
        {0.18401,0.294149,0.357697,0.505306,-0.0952575,-0.254155,-0.166291,-0.236949,-0.23085,0.141055},
        {0.161241,0.289536,0.339311,0.563476,-0.253307,-0.38964,-0.171436,-0.248853,-0.00868123,0.0529501},
        {0.203191,0.343795,0.378623,0.369493,-0.0520884,-0.194201,-0.137257,-0.119521,-0.355257,0.0356871},
        {0.229272,0.271008,0.375981,0.394043,-0.202615,-0.364669,-0.0824151,-0.250081,-0.21947,0.0889461}
    };
#endif
  
#if deg7 
    double d1[5][10] = {
        {0.23337,0.340781,0.360396,0.50912,-0.132583,-0.305335,-0.15835,-0.235382,-0.206483,0.108969},
        {0.240676,0.361545,0.328231,0.410251,-0.105575,-0.182004,-0.129082,-0.239813,-0.115716,0.018708},
        {0.216525,0.349923,0.461581,0.400642,-0.11834,-0.274333,-0.168312,-0.147344,-0.148751,0.0513287},
        {0.24523,0.268792,0.353208,0.343201,-0.14802,-0.203049,-0.213857,-0.139986,-0.267208,0.18439},
        {0.299159,0.370108,0.403848,0.295206,-0.057741,-0.213337,-0.162167,-0.130216,-0.142562,-0.0122919}
    };
    
    
    double d2[5][10]=  {
        {0.203375,0.312023,0.33169,0.494735,-0.134543,-0.309076,-0.142767,-0.235718,-0.207982,0.101724},
        {0.210552,0.333059,0.299944,0.39334,-0.10751,-0.188218,-0.115059,-0.240765,-0.118536,0.0139313},
        {0.187129,0.32149,0.432182,0.385391,-0.120502,-0.27858,-0.151088,-0.148807,-0.149541,0.0423764},
        {0.216928,0.242138,0.325805,0.326608,-0.149881,-0.206897,-0.19202,-0.141794,-0.266267,0.176538},
        {0.26772,0.340275,0.373016,0.280735,-0.0612741,-0.219704,-0.145385,-0.131988,-0.144298,-0.0164114}
    };
#endif
    
#endif
    
    
      //-----------------------------------------------------------------------------------------------
#if nhanes
    
    long dim = 16;
    
    dVec HEtheta;
    for(long i = 0; i < dim; ++i){
        HEtheta.push_back(0);
    }
    dVec theta = HEtheta;
    
#if deg3
    
    double d1[5][16] = {
        {-0.509702,-0.436656,0.812806,-0.104327,-0.178984,-0.273675,-0.0569273,-0.405834,-0.523567,-0.111917,-0.127165,-0.24938,-0.383506,0.123729,-0.249789,-0.188048},
        {-0.511547,-0.428814,0.79463,-0.11388,-0.172645,-0.277063,-0.0600614,-0.40531,-0.523367,-0.123478,-0.132929,-0.220274,-0.3786,0.0885165,-0.220708,-0.181821},
        {-0.507992,-0.427226,0.791156,-0.106124,-0.159646,-0.29013,-0.0567484,-0.415313,-0.522236,-0.130412,-0.134872,-0.232424,-0.372524,0.0979456,-0.23232,-0.18985},
        {-0.509376,-0.432348,0.797631,-0.126974,-0.175651,-0.279435,-0.0532585,-0.411935,-0.525635,-0.114459,-0.14472,-0.228384,-0.365355,0.0840068,-0.227922,-0.170983},
        {-0.510039,-0.413817,0.791328,-0.122951,-0.172852,-0.269375,-0.0671568,-0.393519,-0.526029,-0.108344,-0.130484,-0.240543,-0.379729,0.110248,-0.240923,-0.18537}
    };
    
    // unenc
    double d2[5][16]=  {
        {-0.417536,-0.408259,0.826907,-0.0839599,-0.147082,-0.220024,-0.0505396,-0.316469,-0.431089,-0.0250014,-0.102938,-0.206636,-0.314598,0.104004,-0.206636,-0.112228},
        {-0.418896,-0.401888,0.812628,-0.0926409,-0.140102,-0.223175,-0.0539007,-0.315327,-0.430735,-0.0361079,-0.106885,-0.180727,-0.312011,0.0741434,-0.180727,-0.104924},
        {-0.41368,-0.404316,0.81022,-0.0847799,-0.127832,-0.23485,-0.0513436,-0.323945,-0.428598,-0.042761,-0.10841,-0.191883,-0.305269,0.0834724,-0.191883,-0.113023},
        {-0.416963,-0.406645,0.814641,-0.104314,-0.142158,-0.226073,-0.0481087,-0.32242,-0.432904,-0.0273535,-0.116536,-0.187911,-0.300427,0.0716744,-0.187911,-0.0944277},
        {-0.417996,-0.385368,0.807054,-0.100575,-0.140205,-0.216252,-0.0608955,-0.304873,-0.433389,-0.0219947,-0.105711,-0.198094,-0.312285,0.0926891,-0.198094,-0.109833}
    };
#endif
    
#if deg7
    
    double d1[5][16] = {
        {-0.386908,-0.342747,0.633259,-0.0820743,-0.130115,-0.209118,-0.0453112,-0.303979,-0.398057,-0.0706921,-0.0931633,-0.18554,-0.292709,0.0931659,-0.185468,-0.125443},
        {-0.387296,-0.343143,0.658761,-0.0874399,-0.132796,-0.204762,-0.0478443,-0.305208,-0.39983,-0.080535,-0.0987078,-0.175728,-0.287854,0.0773493,-0.175564,-0.126196},
        {-0.380768,-0.35364,0.651971,-0.092917,-0.12588,-0.207294,-0.0457791,-0.301225,-0.391926,-0.0672453,-0.105946,-0.189288,-0.274506,0.0846216,-0.189846,-0.127777},
        {-0.384959,-0.354486,0.65843,-0.085151,-0.133295,-0.209428,-0.0416175,-0.300128,-0.396936,-0.0686171,-0.100872,-0.177275,-0.283519,0.076367,-0.177419,-0.127996},
        {-0.382264,-0.348052,0.654011,-0.0928662,-0.118096,-0.217502,-0.0461899,-0.312024,-0.396309,-0.0739655,-0.100359,-0.175623,-0.281793,0.0760841,-0.175397,-0.124201}
    };
    
    // unenc
    double d2[5][16]=  {
        {-0.36747,-0.389659,0.647536,-0.0826648,-0.122534,-0.199535,-0.0443042,-0.287882,-0.379549,-0.0528479,-0.0875986,-0.183383,-0.279872,0.0960378,-0.183383,-0.108428},
        {-0.367703,-0.389275,0.67293,-0.0879813,-0.125456,-0.194841,-0.0469033,-0.288982,-0.381326,-0.0634198,-0.0931606,-0.173335,-0.274543,0.0804283,-0.173335,-0.109262},
        {-0.361403,-0.398413,0.66566,-0.0930521,-0.118982,-0.197413,-0.0448409,-0.285499,-0.373695,-0.0498745,-0.100276,-0.187494,-0.261127,0.0872186,-0.187494,-0.111123},
        {-0.365904,-0.400712,0.672282,-0.0857551,-0.125807,-0.199267,-0.0403109,-0.284188,-0.378694,-0.0512406,-0.0957335,-0.17482,-0.270171,0.0793422,-0.17482,-0.110903},
        {-0.363435,-0.390017,0.667482,-0.0932839,-0.110943,-0.207487,-0.0452524,-0.296227,-0.378173,-0.0565097,-0.0948731,-0.173227,-0.268562,0.0786063,-0.173227,-0.107617}
    };
#endif
    
#endif
    
    
#if pcs
    
    long dim = 10;
    
    dVec HEtheta;
    for(long i = 0; i < dim; ++i){
        HEtheta.push_back(0);
    }
    dVec theta = HEtheta;
    
    
#if deg3
    // enc
    double d1[5][10] = {
        {-0.396804,-0.409782,-0.131726,-0.62876,-0.178234,0.278771,0.334936,0.907458,-0.498244,0.0468849},
        {-0.323273,-0.3064,-0.222945,-0.688208,-0.288657,0.293826,0.319125,0.799614,-0.386816,0.105713},
        {-0.40622,-0.410778,-0.206003,-0.634669,-0.173537,0.23467,0.191136,0.948636,-0.363979,0.0353504},
        {-0.345967,-0.336286,-0.265665,-0.710789,-0.358499,0.40369,0.302459,0.727827,-0.302868,0.123272},
        {-0.294109,-0.314517,-0.287464,-0.718921,-0.154705,0.260062,0.416831,0.772349,-0.482361,0.099255}
    };
    
    // unenc
    double d2[5][10]=  {
        {-0.325608,-0.335742,-0.0610194,-0.548909,-0.137763,0.253188,0.291079,0.716666,-0.348864,0.0905624},
        {-0.260603,-0.241469,-0.140363,-0.607566,-0.244686,0.253319,0.279206,0.605749,-0.258191,0.141257},
        {-0.329762,-0.331809,-0.114874,-0.552862,-0.135744,0.211456,0.160556,0.740585,-0.246913,0.0820288},
        {-0.277286,-0.265268,-0.181245,-0.624341,-0.29568,0.345954,0.26791,0.536757,-0.186921,0.164677},
        {-0.230608,-0.2483,-0.205389,-0.632893,-0.128098,0.241532,0.373072,0.590657,-0.330987,0.137249}
    };
#endif
    
#if deg7
    // enc
    double d1[5][10] = {
        {-0.291031,-0.292615,-0.146587,-0.534505,-0.233712,0.253309,0.266031,0.601826,-0.273377,0.0657083},
        {-0.296123,-0.306986,-0.151729,-0.463651,-0.200342,0.266079,0.200702,0.663068,-0.243162,0.0556476},
        {-0.25627,-0.257151,-0.213695,-0.560226,-0.133541,0.263721,0.239975,0.666216,-0.296886,0.0849749},
        {-0.218091,-0.202982,-0.160825,-0.487106,-0.131102,0.101116,0.242501,0.591813,-0.400647,0.108983},
        {-0.271263,-0.277104,-0.124402,-0.579099,-0.178999,0.266336,0.266124,0.616188,-0.270593,0.0655934}
    };
    
    // unenc
    double d2[5][10]=  {
        {-0.277091,-0.278476,-0.129332,-0.519732,-0.22412,0.246515,0.25788,0.579047,-0.252402,0.0741219},
        {-0.28185,-0.292581,-0.135985,-0.451484,-0.190421,0.25892,0.194446,0.639444,-0.223924,0.064986},
        {-0.24341,-0.24393,-0.197337,-0.544683,-0.127067,0.25653,0.234502,0.650726,-0.278517,0.092739},
        {-0.206807,-0.191062,-0.146287,-0.474637,-0.127135,0.0993992,0.236159,0.566037,-0.374476,0.11547},
        {-0.25875,-0.264167,-0.10926,-0.56499,-0.171994,0.259195,0.258927,0.598907,-0.252123,0.0732831}
    };
#endif
#endif
    
    
    
#if uis
    
    long dim = 9;
    
    dVec HEtheta;
    for(long i = 0; i < dim; ++i){
        HEtheta.push_back(0);
    }
    dVec theta = HEtheta;
    
    
#if deg3
    // enc
    double d1[5][9] = {
        {0.384215,0.191973,0.434771,-0.317343,0.254925,0.301087,0.33959,0.488754,0.142825},
        {0.324928,0.155588,0.10235,-0.371976,0.176389,0.316115,0.374546,0.414583,0.394635},
        {0.344823,0.153075,0.180152,-0.0301378,-0.0275188,0.363993,0.447671,0.356882,0.263324},
        {0.352371,0.181306,0.177223,-0.119848,0.074264,0.292695,0.40553,0.373648,0.319083},
        {0.24951,0.114417,0.28154,-0.271076,0.0178798,0.427462,0.402376,0.386603,0.231958}
    };
    
    // unenc
    double d2[5][9]=  {
        {0.253091,0.0602054,0.319134,-0.315853,0.203712,0.268911,0.236565,0.399009,0.0646211},
        {0.221026,0.0483443,0.0257128,-0.344558,0.131891,0.249146,0.274804,0.335384,0.299215},
        {0.220208,0.0313082,0.0928322,-0.0612107,-0.0546365,0.311081,0.338718,0.277298,0.179891},
        {0.229009,0.0583257,0.0885778,-0.137879,0.0366888,0.244216,0.301204,0.295203,0.23007},
        {0.138754,0.00141469,0.184895,-0.261925,-0.0187373,0.374976,0.303354,0.308262,0.155218}
    };
#endif
    
#if deg7
    // enc
    double d1[5][9] = {
        {0.183495,0.104425,0.177821,-0.225676,0.0609212,0.278777,0.250036,0.385556,0.223898},
        {0.206025,0.0451485,0.183937,-0.179252,0.0517283,0.273098,0.241186,0.315526,0.217613},
        {0.236503,0.0786809,0.151718,-0.128854,0.173713,0.357246,0.294785,0.310382,0.166837},
        {0.235495,0.107051,0.147793,-0.252712,0.0268938,0.271813,0.326528,0.312734,0.18549},
        {0.293067,0.131642,0.153259,-0.141633,0.0278621,0.212043,0.343242,0.19066,0.18186}
    };
    
    // unenc
    double d2[5][9]=  {
        {0.155178,0.0775829,0.15848,-0.232455,0.0514927,0.291044,0.231494,0.372177,0.207281},
        {0.178169,0.0185114,0.16655,-0.184599,0.0422327,0.281805,0.2232,0.301977,0.199971},
        {0.204922,0.0480639,0.131435,-0.139319,0.164798,0.387524,0.275573,0.298676,0.147496},
        {0.206303,0.0797317,0.129896,-0.259443,0.016184,0.287227,0.306874,0.299711,0.168025},
        {0.261984,0.102016,0.135746,-0.150942,0.0185771,0.223012,0.323259,0.178307,0.165088}
    };
#endif
#endif
    
    
    
    double avg_MSE = 0.0;
    double avg_NMSE= 0.0;
    
    for(long k = 0; k < 5; ++k){
        for(long i = 0; i < dim; ++i){
            HEtheta[i] = d1[k][i];
            theta[i]   = d2[k][i];
        }
        
        avg_MSE += getMSE(HEtheta, theta);
        avg_NMSE += getNMSE(HEtheta, theta);
    }
    
    avg_MSE/= 5.0;
    avg_NMSE/= 5.0;

    //cout << avg_MSE << endl;
    //cout << avg_NMSE << endl;
    
    for(long i = 0; i < dim; ++i){
        for(long k = 0; k < 4; ++k){
            cout << d2[k][i] <<",";
        }
        cout << d2[4][i] << ";" << endl;
    }
    
    
    return 0;
}






